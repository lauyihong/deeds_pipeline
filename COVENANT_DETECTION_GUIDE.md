# å¥‘çº¦æ£€æµ‹å•ç‹¬è¿è¡ŒæŒ‡å—

## ğŸ“‹ èƒŒæ™¯

ç”±äº Mistral-RRC æ¨¡å‹ï¼ˆ15GBï¼‰åœ¨ CPU ä¸Šè¿è¡Œéå¸¸æ…¢ï¼ˆæ¯ä¸ªå¥‘çº¦1-2åˆ†é’Ÿï¼‰ï¼Œæˆ‘ä»¬æš‚æ—¶è·³è¿‡äº†å¥‘çº¦æ£€æµ‹æ­¥éª¤ã€‚

**å½“å‰ Step 2 ä¼šå®Œæˆ**ï¼š
- âœ… OCR æ–‡å­—æå–ï¼ˆGoogle Visionï¼‰
- âœ… ç»“æ„åŒ–ä¿¡æ¯æå–ï¼ˆGemini APIï¼‰
- â­ï¸ å¥‘çº¦æ£€æµ‹ï¼ˆæš‚æ—¶è·³è¿‡ï¼‰

**ç¨åå¯ä»¥å•ç‹¬è¿è¡Œ**ï¼š
- ğŸ¤– å¥‘çº¦æ£€æµ‹ï¼ˆMistral-RRC æ¨¡å‹ï¼‰

---

## ğŸš€ ç°åœ¨è¿è¡Œ Step 2ï¼ˆå¿«é€Ÿç‰ˆæœ¬ï¼‰

åœ¨ notebook ä¸­ï¼š

```python
# é‡å¯ kernel ä»¥åŠ è½½æ–°ä»£ç 
# Kernel â†’ Restart Kernel

# ç„¶åè¿è¡Œ
from deeds_pipeline.step2_ocr_extraction import run_step2

result = run_step2()
```

ç°åœ¨ä¼šå¾ˆå¿«ï¼Œå› ä¸ºï¼š
- å·²ç¼“å­˜çš„å¥‘çº¦ï¼šç«‹å³è¿”å›
- æ–°å¥‘çº¦ï¼šåªè¿è¡Œ OCR + Geminiï¼ˆçº¦10-20ç§’/å¥‘çº¦ï¼‰
- è·³è¿‡ Mistral æ¨¡å‹ï¼ˆèŠ‚çœ1-2åˆ†é’Ÿ/å¥‘çº¦ï¼‰

---

## ğŸ¤– ç¨åè¿è¡Œå¥‘çº¦æ£€æµ‹

### é€‰é¡¹ 1: åœ¨æ›´å¿«çš„æœºå™¨ä¸Šè¿è¡Œ

æ¨èåœ¨ä»¥ä¸‹ç¯å¢ƒè¿è¡Œï¼š
- **Google Colab**ï¼ˆå…è´¹ GPUï¼‰
- **AWS/GCP è™šæ‹Ÿæœº**ï¼ˆå¸¦ GPUï¼‰
- **æœ¬åœ° GPU æœºå™¨**

```bash
# å¤åˆ¶ Step 2 è¾“å‡ºæ–‡ä»¶åˆ°ç›®æ ‡æœºå™¨
# ç„¶åè¿è¡Œ

conda activate deeds_crawl
python run_covenant_detection.py
```

### é€‰é¡¹ 2: åœ¨ Mac ä¸Šè¿‡å¤œè¿è¡Œ

å¦‚æœæ‚¨æ„¿æ„ç­‰å¾… 9-18 å°æ—¶ï¼š

```bash
# å…ˆæµ‹è¯•å‡ ä¸ªå¥‘çº¦
python run_covenant_detection.py --limit 5

# å¦‚æœæˆåŠŸï¼Œè¿è¡Œå…¨éƒ¨
nohup python run_covenant_detection.py &
```

### é€‰é¡¹ 3: åˆ†æ‰¹å¤„ç†

```bash
# æ¯æ¬¡å¤„ç† 50 ä¸ªå¥‘çº¦
python run_covenant_detection.py --limit 50 --output step2_batch1.json

# ç­‰å¤„ç†å®Œåï¼Œç»§ç»­ä¸‹ä¸€æ‰¹...
```

---

## ğŸ“Š è¾“å‡ºæ ¼å¼

å¥‘çº¦æ£€æµ‹ç»“æœä¼šæ·»åŠ åˆ° Step 2 è¾“å‡ºä¸­ï¼š

```json
{
  "deed_id": "3251",
  "ocr_results": [
    {
      "image_url": "...",
      "ocr_text": "...",
      "covenant_detection": {
        "covenant_detected": true,
        "raw_passage": "åŸå§‹æ®µè½æ–‡æœ¬",
        "corrected_quotation": "ä¿®æ­£åçš„å¼•ç”¨"
      },
      "extracted_info": {
        "street_addresses": ["Main St"],
        ...
      }
    }
  ]
}
```

---

## ğŸ”„ ç»§ç»­å®Œæ•´ Pipeline

å³ä½¿è·³è¿‡äº†å¥‘çº¦æ£€æµ‹ï¼Œæ‚¨ä»ç„¶å¯ä»¥ç»§ç»­è¿è¡Œï¼š

âœ… **Step 3**: ç½‘é¡µæŠ“å–ï¼ˆè·å–æ›´å¤šè¡—é“åœ°å€ï¼‰
âœ… **Step 4**: åœ°ç†ç¼–ç ï¼ˆå®šä½å¥‘çº¦ä½ç½®ï¼‰
âœ… **Step 5**: æ•°æ®æ•´åˆå’Œå¯¼å‡º

å¥‘çº¦æ£€æµ‹å¯ä»¥éšæ—¶è¡¥å……ï¼Œä¸ä¼šå½±å“å…¶ä»–æ­¥éª¤ã€‚

---

## âš¡ å¿«é€Ÿå¼€å§‹

### 1. åœ¨ Notebook ä¸­å®Œæˆ Step 2ï¼ˆå¿«é€Ÿï¼‰

```python
# é‡å¯ kernel
from deeds_pipeline.step2_ocr_extraction import run_step2
result = run_step2()
```

### 2. ç»§ç»­ Pipeline

```python
# è¿è¡Œ Step 3-5
# ï¼ˆå‚è€ƒ notebook ä¸­çš„ç°æœ‰ cellsï¼‰
```

### 3. ç¨åæ·»åŠ å¥‘çº¦æ£€æµ‹

```bash
# åœ¨æ›´å¿«çš„æœºå™¨ä¸Šè¿è¡Œ
python run_covenant_detection.py
```

---

## ğŸ’¡ ä¼°ç®—æ—¶é—´

### å½“å‰é…ç½®ï¼ˆè·³è¿‡ Mistralï¼‰
- å·²ç¼“å­˜å¥‘çº¦ï¼š<1ç§’
- æ–°å¥‘çº¦ï¼š10-20ç§’ï¼ˆOCR + Geminiï¼‰
- **æ€»è®¡ï¼ˆ570ä¸ªå¥‘çº¦ï¼‰**ï¼šçº¦1-2å°æ—¶

### å®Œæ•´ç‰ˆæœ¬ï¼ˆåŒ…å« Mistralï¼‰
- CPUï¼š1-2åˆ†é’Ÿ/å¥‘çº¦
- **æ€»è®¡ï¼ˆ570ä¸ªå¥‘çº¦ï¼‰**ï¼š9-18å°æ—¶ â°
- GPUï¼š5-10ç§’/å¥‘çº¦
- **æ€»è®¡ï¼ˆ570ä¸ªå¥‘çº¦ï¼‰**ï¼šçº¦1å°æ—¶ âš¡

---

## âœ… æ¨èæµç¨‹

1. **ç°åœ¨**ï¼šè¿è¡Œ Step 2ï¼ˆè·³è¿‡ Mistralï¼‰â†’ å®Œæˆ Step 3-5
2. **ç¨å**ï¼šåœ¨æ›´å¿«çš„æœºå™¨ä¸Šè¿è¡Œå¥‘çº¦æ£€æµ‹
3. **æœ€å**ï¼šå°†å¥‘çº¦æ£€æµ‹ç»“æœåˆå¹¶åˆ°æœ€ç»ˆè¾“å‡º

è¿™æ ·å¯ä»¥è®©æ‚¨å¿«é€Ÿå®Œæˆæ•´ä¸ª pipelineï¼Œå¥‘çº¦æ£€æµ‹å¯ä»¥ä½œä¸ºå¯é€‰çš„å¢å¼ºæ­¥éª¤ï¼
